# 数据库表结构初稿（v0.1）

本文件提供核心表结构草案，便于快速建立数据库与联调。已按 MySQL 8.x 兼容调整类型与约束。

**1. 用户与实名**

**1.1 用户表 `users`**
```sql
CREATE TABLE users (
  id            varchar(32) PRIMARY KEY,
  phone         varchar(20) UNIQUE NOT NULL,
  email         varchar(128),
  password_hash varchar(128) NOT NULL,
  status        varchar(16) NOT NULL,
  kyc_status    varchar(16) NOT NULL,
  member_level  varchar(16) NOT NULL,
  created_at    datetime NOT NULL,
  updated_at    datetime NOT NULL
);
```

**1.2 实名表 `kyc_records`**
```sql
CREATE TABLE kyc_records (
  id           varchar(32) PRIMARY KEY,
  user_id      varchar(32) NOT NULL,
  real_name    varchar(64) NOT NULL,
  id_number    varchar(32) NOT NULL,
  provider     varchar(32) NOT NULL,
  status       varchar(16) NOT NULL,
  reason       varchar(256),
  submitted_at datetime NOT NULL,
  reviewed_at  datetime,
  FOREIGN KEY (user_id) REFERENCES users(id)
);
```

**2. 股票推荐**

**2.1 推荐表 `stock_recommendations`**
```sql
CREATE TABLE stock_recommendations (
  id            varchar(32) PRIMARY KEY,
  symbol        varchar(16) NOT NULL,
  name          varchar(64) NOT NULL,
  score         decimal(6,2) NOT NULL,
  risk_level    varchar(16) NOT NULL,
  position_range varchar(32),
  valid_from    datetime NOT NULL,
  valid_to      datetime NOT NULL,
  status        varchar(16) NOT NULL,
  reason_summary varchar(512),
  created_at    datetime NOT NULL
);
```

**2.2 推荐详情表 `stock_reco_details`**
```sql
CREATE TABLE stock_reco_details (
  reco_id          varchar(32) PRIMARY KEY,
  tech_score       decimal(6,2),
  fund_score       decimal(6,2),
  sentiment_score  decimal(6,2),
  money_flow_score decimal(6,2),
  take_profit      varchar(256),
  stop_loss        varchar(256),
  risk_note        varchar(512),
  FOREIGN KEY (reco_id) REFERENCES stock_recommendations(id)
);
```

**3. 期货策略与套利**

**3.1 期货策略表 `futures_strategies`**
```sql
CREATE TABLE futures_strategies (
  id            varchar(32) PRIMARY KEY,
  contract      varchar(32) NOT NULL,
  name          varchar(64),
  direction     varchar(16) NOT NULL,
  risk_level    varchar(16) NOT NULL,
  position_range varchar(32),
  valid_from    datetime NOT NULL,
  valid_to      datetime NOT NULL,
  status        varchar(16) NOT NULL,
  reason_summary varchar(512)
);
```

**3.2 套利表 `arbitrage_recos`**
```sql
CREATE TABLE arbitrage_recos (
  id           varchar(32) PRIMARY KEY,
  type         varchar(16) NOT NULL,
  contract_a   varchar(32) NOT NULL,
  contract_b   varchar(32) NOT NULL,
  spread       decimal(10,2),
  percentile   decimal(6,4),
  entry_point  decimal(10,2),
  exit_point   decimal(10,2),
  stop_point   decimal(10,2),
  trigger_rule varchar(256),
  status       varchar(16) NOT NULL
);
```

**4. 市场动态**

**4.1 动态表 `market_events`**
```sql
CREATE TABLE market_events (
  id           varchar(32) PRIMARY KEY,
  event_type   varchar(32) NOT NULL,
  symbol       varchar(32) NOT NULL,
  summary      varchar(512),
  trigger_rule varchar(256),
  source       varchar(64),
  created_at   datetime NOT NULL
);
```

**5. 公开持仓/持股**

**5.1 机构持股表 `public_holdings`**
```sql
CREATE TABLE public_holdings (
  id           varchar(32) PRIMARY KEY,
  holder       varchar(128) NOT NULL,
  symbol       varchar(32) NOT NULL,
  ratio        decimal(6,3),
  disclosed_at datetime NOT NULL,
  source       varchar(64)
);
```

**5.2 期货持仓结构表 `futures_positions_public`**
```sql
CREATE TABLE futures_positions_public (
  id             varchar(32) PRIMARY KEY,
  contract       varchar(32) NOT NULL,
  long_position  decimal(16,2),
  short_position decimal(16,2),
  disclosed_at   datetime NOT NULL,
  source         varchar(64)
);
```

**6. 订阅与消息**

**6.1 订阅表 `subscriptions`**
```sql
CREATE TABLE subscriptions (
  id         varchar(32) PRIMARY KEY,
  user_id    varchar(32) NOT NULL,
  type       varchar(32) NOT NULL,
  scope      varchar(64),
  frequency  varchar(16) NOT NULL,
  status     varchar(16) NOT NULL
);
```

**6.2 消息表 `messages`**
```sql
CREATE TABLE messages (
  id          varchar(32) PRIMARY KEY,
  user_id     varchar(32) NOT NULL,
  title       varchar(128) NOT NULL,
  content     text NOT NULL,
  type        varchar(16) NOT NULL,
  read_status varchar(16) NOT NULL,
  created_at  datetime NOT NULL
);
```

**7. 会员与订单**

**7.1 会员产品表 `membership_products`**
```sql
CREATE TABLE membership_products (
  id       varchar(32) PRIMARY KEY,
  name     varchar(64) NOT NULL,
  price    decimal(10,2) NOT NULL,
  status   varchar(16) NOT NULL
);
```

**7.2 会员订单表 `membership_orders`**
```sql
CREATE TABLE membership_orders (
  id         varchar(32) PRIMARY KEY,
  user_id    varchar(32) NOT NULL,
  product_id varchar(32) NOT NULL,
  amount     decimal(10,2) NOT NULL,
  status     varchar(16) NOT NULL,
  paid_at    datetime
);
```

**8. 新闻资讯**

**8.1 新闻分类表 `news_categories`**
```sql
CREATE TABLE news_categories (
  id         varchar(32) PRIMARY KEY,
  name       varchar(64) NOT NULL,
  slug       varchar(64) NOT NULL UNIQUE,
  sort       int NOT NULL DEFAULT 0,
  visibility varchar(16) NOT NULL,
  status     varchar(16) NOT NULL,
  created_at datetime NOT NULL,
  updated_at datetime NOT NULL
);
```

**8.2 新闻文章表 `news_articles`**
```sql
CREATE TABLE news_articles (
  id           varchar(32) PRIMARY KEY,
  category_id  varchar(32) NOT NULL,
  title        varchar(256) NOT NULL,
  summary      varchar(512),
  content      mediumtext NOT NULL,
  tags         json,
  visibility   varchar(16) NOT NULL,
  status       varchar(16) NOT NULL,
  published_at datetime,
  author_id    varchar(32) NOT NULL,
  created_at   datetime NOT NULL,
  updated_at   datetime NOT NULL,
  FOREIGN KEY (category_id) REFERENCES news_categories(id)
);
```

**8.3 新闻附件表 `news_attachments`**
```sql
CREATE TABLE news_attachments (
  id         varchar(32) PRIMARY KEY,
  article_id varchar(32) NOT NULL,
  file_name  varchar(256) NOT NULL,
  file_url   varchar(512) NOT NULL,
  file_size  bigint NOT NULL,
  mime_type  varchar(128),
  created_at datetime NOT NULL,
  FOREIGN KEY (article_id) REFERENCES news_articles(id)
);
```

**9. 客户增长与激励**

**9.1 浏览历史表 `browse_histories`**
```sql
CREATE TABLE browse_histories (
  id          varchar(32) PRIMARY KEY,
  user_id     varchar(32) NOT NULL,
  content_type varchar(16) NOT NULL,
  content_id  varchar(32) NOT NULL,
  source_page varchar(64),
  viewed_at   datetime NOT NULL,
  INDEX idx_user_viewed_at (user_id, viewed_at)
);
```

**9.2 充值记录表 `recharge_records`**
```sql
CREATE TABLE recharge_records (
  id          varchar(32) PRIMARY KEY,
  user_id     varchar(32) NOT NULL,
  order_no    varchar(64) NOT NULL UNIQUE,
  amount      decimal(10,2) NOT NULL,
  pay_channel varchar(16) NOT NULL,
  status      varchar(16) NOT NULL,
  paid_at     datetime,
  remark      varchar(256),
  created_at  datetime NOT NULL,
  INDEX idx_user_created_at (user_id, created_at)
);
```

**9.3 分享链接表 `invite_links`**
```sql
CREATE TABLE invite_links (
  id          varchar(32) PRIMARY KEY,
  user_id     varchar(32) NOT NULL,
  invite_code varchar(32) NOT NULL UNIQUE,
  url         varchar(512) NOT NULL,
  channel     varchar(64),
  status      varchar(16) NOT NULL,
  expired_at  datetime,
  created_at  datetime NOT NULL
);
```

**9.4 邀请记录表 `invite_records`**
```sql
CREATE TABLE invite_records (
  id              varchar(32) PRIMARY KEY,
  inviter_user_id varchar(32) NOT NULL,
  invitee_user_id varchar(32) NOT NULL,
  invite_link_id  varchar(32) NOT NULL,
  register_at     datetime,
  kyc_at          datetime,
  first_pay_at    datetime,
  status          varchar(16) NOT NULL,
  risk_flag       varchar(16) NOT NULL DEFAULT 'NORMAL',
  UNIQUE KEY uk_invitee_once (invitee_user_id),
  FOREIGN KEY (invite_link_id) REFERENCES invite_links(id)
);
```

**9.5 分享奖励记录表 `share_reward_records`**
```sql
CREATE TABLE share_reward_records (
  id               varchar(32) PRIMARY KEY,
  inviter_user_id  varchar(32) NOT NULL,
  invitee_user_id  varchar(32) NOT NULL,
  invite_record_id varchar(32) NOT NULL,
  reward_type      varchar(16) NOT NULL,
  reward_value     decimal(10,2) NOT NULL,
  trigger_event    varchar(32) NOT NULL,
  status           varchar(16) NOT NULL,
  issued_at        datetime,
  review_reason    varchar(256),
  created_at       datetime NOT NULL,
  FOREIGN KEY (invite_record_id) REFERENCES invite_records(id),
  INDEX idx_inviter_created_at (inviter_user_id, created_at)
);
```

**10. 会员配额**

**10.1 会员配额配置表 `vip_quota_configs`**
```sql
CREATE TABLE vip_quota_configs (
  id                   varchar(32) PRIMARY KEY,
  member_level         varchar(16) NOT NULL,
  doc_read_limit       int NOT NULL,
  news_subscribe_limit int NOT NULL,
  reset_cycle          varchar(16) NOT NULL,
  status               varchar(16) NOT NULL,
  effective_at         datetime NOT NULL,
  updated_at           datetime NOT NULL,
  UNIQUE KEY uk_member_level_effective (member_level, effective_at),
  INDEX idx_member_level_status (member_level, status)
);
```

**10.2 用户配额使用表 `user_quota_usages`**
```sql
CREATE TABLE user_quota_usages (
  id                   varchar(32) PRIMARY KEY,
  user_id              varchar(32) NOT NULL,
  member_level         varchar(16) NOT NULL,
  period_key           varchar(16) NOT NULL,
  doc_read_used        int NOT NULL DEFAULT 0,
  news_subscribe_used  int NOT NULL DEFAULT 0,
  updated_at           datetime NOT NULL,
  UNIQUE KEY uk_user_period (user_id, period_key),
  INDEX idx_member_level_period (member_level, period_key)
);
```

**11. 支付与奖励结算**

**11.1 奖励账户表 `reward_wallets`**
```sql
CREATE TABLE reward_wallets (
  id               varchar(32) PRIMARY KEY,
  user_id          varchar(32) NOT NULL UNIQUE,
  cash_balance     decimal(12,2) NOT NULL DEFAULT 0,
  cash_frozen      decimal(12,2) NOT NULL DEFAULT 0,
  coupon_balance   decimal(12,2) NOT NULL DEFAULT 0,
  vip_days_balance int NOT NULL DEFAULT 0,
  updated_at       datetime NOT NULL
);
```

**11.2 奖励流水表 `reward_wallet_txns`**
```sql
CREATE TABLE reward_wallet_txns (
  id         varchar(32) PRIMARY KEY,
  wallet_id  varchar(32) NOT NULL,
  txn_type   varchar(16) NOT NULL,
  amount     decimal(12,2) NOT NULL,
  status     varchar(16) NOT NULL,
  ref_id     varchar(64),
  created_at datetime NOT NULL,
  FOREIGN KEY (wallet_id) REFERENCES reward_wallets(id),
  INDEX idx_wallet_created_at (wallet_id, created_at)
);
```

**11.3 提现申请表 `withdraw_requests`**
```sql
CREATE TABLE withdraw_requests (
  id            varchar(32) PRIMARY KEY,
  user_id       varchar(32) NOT NULL,
  amount        decimal(12,2) NOT NULL,
  status        varchar(16) NOT NULL,
  review_reason varchar(256),
  applied_at    datetime NOT NULL,
  reviewed_at   datetime,
  INDEX idx_user_applied_at (user_id, applied_at)
);
```

**11.4 支付回调日志表 `payment_callback_logs`**
```sql
CREATE TABLE payment_callback_logs (
  id              varchar(32) PRIMARY KEY,
  pay_channel     varchar(16) NOT NULL,
  order_no        varchar(64) NOT NULL,
  channel_txn_no  varchar(64) NOT NULL,
  sign_verified   tinyint(1) NOT NULL,
  idempotency_key varchar(128) NOT NULL,
  callback_status varchar(16) NOT NULL,
  created_at      datetime NOT NULL,
  UNIQUE KEY uk_idempotency_key (idempotency_key)
);
```

**11.5 对账批次表 `reconciliation_records`**
```sql
CREATE TABLE reconciliation_records (
  id          varchar(32) PRIMARY KEY,
  pay_channel varchar(16) NOT NULL,
  batch_date  date NOT NULL,
  status      varchar(16) NOT NULL,
  diff_count  int NOT NULL DEFAULT 0,
  created_at  datetime NOT NULL,
  UNIQUE KEY uk_channel_batch (pay_channel, batch_date)
);
```

**12. 风控配置与命中日志**

**12.1 风控规则表 `risk_rule_configs`**
```sql
CREATE TABLE risk_rule_configs (
  id          varchar(32) PRIMARY KEY,
  rule_code   varchar(32) NOT NULL UNIQUE,
  rule_name   varchar(128) NOT NULL,
  threshold   int NOT NULL,
  status      varchar(16) NOT NULL,
  effective_at datetime NOT NULL,
  updated_at  datetime NOT NULL
);
```

**12.2 风险命中日志表 `risk_hit_logs`**
```sql
CREATE TABLE risk_hit_logs (
  id          varchar(32) PRIMARY KEY,
  rule_code   varchar(32) NOT NULL,
  user_id     varchar(32) NOT NULL,
  event_id    varchar(64) NOT NULL,
  risk_level  varchar(16) NOT NULL,
  status      varchar(32) NOT NULL,
  created_at  datetime NOT NULL,
  INDEX idx_user_created_at (user_id, created_at),
  INDEX idx_rule_status (rule_code, status)
);
```

**12.3 附件下载审计表 `attachment_download_logs`**
```sql
CREATE TABLE attachment_download_logs (
  id            varchar(32) PRIMARY KEY,
  user_id       varchar(32) NOT NULL,
  attachment_id varchar(32) NOT NULL,
  article_id    varchar(32) NOT NULL,
  downloaded_at datetime NOT NULL,
  INDEX idx_user_downloaded_at (user_id, downloaded_at)
);
```
